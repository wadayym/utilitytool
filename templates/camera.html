<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Pragma" content="no-store">
    <meta http-equiv="Cache-Control" content="no-store">
    <meta http-equiv="Expires" content="0">
    <title>ã‚«ãƒ¡ãƒ©è¡¨ç¤º</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      body {
        margin: 0;
        padding: 10px;
        font-family: sans-serif;
      }
      dl {
        max-width: 600px;
        margin: 20px auto;
        padding: 0 10px;
      }
      canvas {
        display: block;
        max-width: 100%;
        height: auto;
        margin: 20px auto;
        border: 1px solid #ccc;
        background: #fafafa;
      }
      label, input[type="file"] {
        font-size: 1rem;
      }
      @media (max-width: 600px) {
        dl {
          max-width: 100%;
          padding: 0;
        }
        canvas {
          width: 100vw !important;
          max-width: 100vw;
          height: auto !important;
        }
      }
    </style>
</head>

<body>
	<dl>
		<dt>ãƒŠãƒ³ãƒãƒ¼ãƒ—ãƒ¬ãƒ¼ã‚¹ã®å•é¡Œã‚’èƒŒé¢ã‚«ãƒ¡ãƒ©ã§æ’®å½±ã—ã¦ãã ã•ã„</dt>
		<dd>
			<div>
				<label>
					<label for="npimage" id="customLabel" style="display:inline-block; padding:10px 15px; background-color:#007bff; color:#fff; border-radius:5px; cursor:pointer;">
						ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„
					</label>
					<input type="file" id="npimage" capture="environment" accept="image/*" style="display:none;">
				</label>
			</div>
		</dd>
	</dl>	

	<canvas id="canvas" width="1200" height="900"></canvas>
	
	<script>
		const label = document.getElementById('customLabel');

		if (navigator.userAgentData) {
			if (navigator.userAgentData.mobile) {
				label.textContent = 'ã‚¹ãƒãƒ›ã®ã‚«ãƒ¡ãƒ©ã§æ’®å½±ã—ã¦ãã ã•ã„ğŸ“±';
				console.log("Mobile device detected (userAgentData)");
				// ã‚¹ãƒãƒ›å‘ã‘å‡¦ç†
			} else {
				 label.textContent = 'PCã‹ã‚‰ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ğŸ’»';
				console.log("Desktop device detected (userAgentData)");
				// PCå‘ã‘å‡¦ç†
			}
		}
		else if (/Mobile|Android|iPhone|iPad/i.test(navigator.userAgent)) {
			label.textContent = 'ã‚¹ãƒãƒ›ã®ã‚«ãƒ¡ãƒ©ã§æ’®å½±ã—ã¦ãã ã•ã„ğŸ“±';
			console.log("Mobile device detected (userAgent)");
			// ã‚¹ãƒãƒ›å‘ã‘å‡¦ç†
		} else {
			label.textContent = 'PCã‹ã‚‰ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ğŸ’»';
			console.log("Desktop device detected (userAgent)");
			// PCå‘ã‘å‡¦ç†
		}



		var form = document.createElement('form');
		var request = document.createElement('input');

		const canvas = document.getElementById('canvas');
		const context = canvas.getContext('2d');

		form.method = 'POST';
		form.action = '/camera';
	
		request.type = 'hidden'; //å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ãŒè¡¨ç¤ºã•ã‚Œãªã„ã‚ˆã†ã«
		request.name = 'image';

		// inputè¦ç´ 
		const fileInput = document.getElementById('npimage');

		var img = new Image();

		// changeã‚¤ãƒ™ãƒ³ãƒˆã§å‘¼ã³å‡ºã™é–¢æ•°
		const handleFileSelect = () => {
			const files = fileInput.files;
			for (let i = 0; i < files.length; i++) {
				console.log(files[i]); // 1ã¤1ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿ã¯files[i]ã§å–å¾—ã§ãã‚‹
			}
			let reader = new FileReader();
			reader.readAsDataURL(files[0]);		
			reader.onload = () => {
				img.src = reader.result;
			}
		}
		img.onload = function(){			
			// å…ƒç”»åƒã‚µã‚¤ã‚º
			const imgWidth = img.width;
			const imgHeight = img.height;
			const maxLen = Math.max(imgWidth, imgHeight);

			// é•·è¾ºãŒ800ã‚’è¶…ãˆãªã„ã‚ˆã†ã«canvasã‚µã‚¤ã‚ºã‚’èª¿æ•´
			let scale = 1;
			if (maxLen > 800) {
				scale = 800 / maxLen;
			}
			canvas.width = Math.round(imgWidth * scale);
			canvas.height = Math.round(imgHeight * scale);

			context.drawImage(img, 0, 0, canvas.width, canvas.height);
			const base64_img = canvas.toDataURL("image/jpeg");
			request.value = base64_img;
			form.appendChild(request);
			document.body.appendChild(form);
			form.submit();
		}
		// ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ™‚ã«handleFileSelectã‚’ç™ºç«
		fileInput.addEventListener('change', handleFileSelect);
	</script>

</body>
</html>